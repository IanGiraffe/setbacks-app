"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useGiraffeState = useGiraffeState;
const iframe_sdk_1 = require("@gi-nx/iframe-sdk");
const react_1 = require("react");
// build issues with react-fast-compare, so just copied source
const react_fast_compare_1 = require("./react-fast-compare");
function useGiraffeState(key) {
    const storeCache = (0, react_1.useRef)({});
    return (0, react_1.useSyncExternalStore)(update => {
        const listenerId = iframe_sdk_1.giraffeState.addListener([key], () => {
            update();
        });
        return () => {
            iframe_sdk_1.giraffeState.removeListener(listenerId);
        };
    }, () => {
        // because some keys are wrapped by FeatureCollection, they need to be checked for actual changes
        if (storeCache.current[key] === undefined || !(0, react_fast_compare_1.isEqual)(storeCache.current[key], iframe_sdk_1.giraffeState.get(key))) {
            storeCache.current[key] = iframe_sdk_1.giraffeState.get(key);
            return storeCache.current[key];
        }
        else {
            return storeCache.current[key];
        }
    });
}
//# sourceMappingURL=iframe-sdk-react.js.map